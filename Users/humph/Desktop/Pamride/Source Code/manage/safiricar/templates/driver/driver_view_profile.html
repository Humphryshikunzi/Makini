{% extends './base.html' %}

{% block content %}

<style>
    .content {
        width: 90% !important;
    }

    .float-container {
        border: 3px solid #fff;
        padding: 5px;
    }

    .float-child {
        width: 50%;
        float: left;
        padding: 5px;
        border-right: 2px solid rgb(145, 255, 0);
    }

    .float-child-right {
        width: 50%;
        float: left;
        padding: 5px;
    }

    td a:visited {
        color: blueviolet !important;
    }

    td a:hover {
        color: #c1c117 !important;
    }

    input {
        position: absolute;
        right: 0;
    }

     /* Float four columns side by side */
     .column {
        float: left;
        width: 50%;
        padding: 0 10px;
    }
        /* Remove extra left and right margins, due to padding */
    .row {margin: 0 -5px;}

    /* Clear floats after the columns */
    .row:after {
    content: "";
    display: table;
    clear: both;
    }
 
    /* Responsive columns */
    @media screen and (max-width: 600px) {
        .column {
            width: 100%;
            display: block;
            margin-bottom: 20px;
        }
    }

    /* Style the counter cards */
    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        padding: 16px;
        text-align: center; 
        height: 210px;
    }

</style>
<link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet" />

<div class="float-container row highlight" style="background-color: #FFF9EFFF;">
    <div class="float-child">
        <div class="green">
            <div class="row highlight" style="padding-top:1%;margin-right: 22px; border-radius: 2%;">
                <h3 class="page-heading">Driver "{{formData.driver.userName}}" Details</h3>
                <div class="column">
                    <div class="card">
                        <input type="file" name="filename" id="filename" accept="image/*" onchange="previewImage()" style="margin-right:1166px; margin-top: 170px;visibility:hidden;" />
                        <img id="profileImageFrame" src="data:image/jpg;base64,{{ formData.profile_image | safe }}" width="160px" height="160px">
                        <br> 
                        <input type="hidden" id="driver_update_id" value="{{formData.driver.id}}" />
                    </div> 
                    <label title="Profile Image" style="margin-left:10px;margin-top:5px;">Profile Image</label>
                </div>

                <div class="column">
                    <div class="card">
                        <img id="profileImageFrame" onclick="view_driver_account_dl_popup(this);"  src="{{ formData.driver.identificationDocumentUrl}}" width="160px" height="160px">
                    </div>                    
                    <label title="Driving Licence" style="margin-left:10px;margin-top:5px;">Driving Licence</label>
                </div>
            </div>

            <form method="post" style="margin-right:30px;" class="form-validate" action="/driver_profile{% if formData.update_id %}/{{formData.update_id}}{% endif %}">
                <div class="row highlight" style="padding-top:1%;border-radius: 2%;"> 

                    <div class="col-md-8" style="padding: 3%;"> 

                        <div class="form-group">
                            <label for="driver_id">Internal ID : </label>
                            <input value="{{formData.driver.id}}" disabled="true" />
                        </div>

                        <div class="form-group">
                            <label for="driver_name">UserName : </label>
                            <input value="{{formData.driver.userName}}" disabled="true" />
                        </div>

                        <div class="form-group">
                            <label for="driver_email">Email : </label>
                            <input value="{{formData.driver.email}}" disabled="true" />
                        </div>

                        <div class="form-group">
                            <label for="driver_nationalid">National Id : </label>
                            <input value="{{formData.driver.nationalId}}" disabled="true" />
                        </div>

                        <div class="form-group">
                            <label for="driver_last_name">Last Name : </label>
                            <input value="{{formData.driver.lastName}}" disabled="true" />
                        </div>

                        <div class="form-group">
                            <label for="driver_last_name">Phone Number : </label>
                            <input value="{{formData.driver.phoneNumber}}" disabled="true" />
                        </div>

                        <div class="form-group">
                            <label for="age">IsActive : </label>
                            <input value="{{formData.driver.isActive}}" disabled="true" />
                        </div>

                        <div class="form-group">
                            <label for="driver_address">Owned Cars : </label>

                            <table id="dtBasicExample" class="table table-striped table-bordered table-sm"  cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th class="th-sm">Licence Plate</th>
                                        <th class="th-sm">Model</th>
                                        <th class="th-sm">Color</th>
                                        <th class="th-sm">Active</th>
                                    </tr>
                                </thead>

                                <tbody>
                                    {% if formData.driver %}
                                    {% for car in formData.driver.ownedCars %}
                                    <tr>
                                        <td>{{car.licensePlate}}</td>
                                        <td>{{car.model}}</td>
                                        <td>{{car.color}}</td>
                                        <td>{{car.active}}</td>
                                    </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="7"> Driver Does not Own Any Car</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                        <input type="hidden" id="driver_delete_id" value="{{formData.update_id}}" />
                        <button type="button" class="btn btn-primary" id="cancel"  onclick="return window.history.back();">Back</button>
                         {% if formData.driver.isVerified == false %}
                        <button type="button" class="btn btn-success"  onclick="verify_driver_account_dl_popup(this);">Verify Account</button>
                        {% else %}
                        
                            {% if formData.driver.isActive %}                            
                              <button type="button" class="btn btn-warning"  onclick="disable_driver_account_popup(this);">Disable Account</button>
                            {% else %}
                              <button type="button" class="btn btn-success"  onclick="activate_driver_account_dl_popup(this);">Activate Account</button>
                            {% endif %}

                        {% endif %}
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="float-child-right">
        <div class="green">
            <form method="post" style="margin-left:30px" class="form-validate" action="/driver_profile{% if formData.update_id %}/{{formData.update_id}}{% endif %}">
                <div class="row highlight" style="padding-top:2%;border-radius: 2%;">
                    <h3 class="page-heading">Driver Activities</h3> 
                    <div class="form-group" style="margin-right: 10px;">                       
                        <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th class="th-sm">ActivityId</th>
                                    <th class="th-sm">Title</th>
                                    <th class="th-sm">Description</th>
                                    <th class="th-sm">Date</th>
                                    <th class="th-sm">Time</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% if formData.userActivities_obj %}
                                {% for userActivity in formData.userActivities_obj %}
                                <tr>
                                    <td>{{userActivity.id}}</td>
                                    <td>{{userActivity.title}}</td>
                                    <td>{{userActivity.description}}</td>
                                    <td>{{userActivity.activityDate}}</td>
                                    <td>{{userActivity.timeOfActivity}}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="7">No Driver Activity Found</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>

                    </div>

                    <input type="hidden" id="driver_delete_id" value="{{formData.update_id}}" />
                </div>
        </div>
        </form>
    </div>
</div>
</div>

<script>
    function disable_driver_account_popup(element) {
        swal({
            title: "Are you sure?",
            text: "You want to Disable this Account? The owner will not be able to use it until its enabled!",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Yes, Disable it!",
            closeOnConfirm: false
        },

            function disable_driver_account() {
                window.location.href = '/disable_driver_account/{{formData.update_id}}';
            });

    }
    function activate_driver_account_dl_popup(element) {
        swal({
            title: "Are you sure?",
            text: "You want to Activate this Account? This assumes that the Driver has been verified and can start using the account!",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Yes, Activate!",
            closeOnConfirm: false
        },

            function activate_driver_account() {
                window.location.href = '/activate_driver_account/{{formData.update_id}}';
            });

    }
    
    function verify_driver_account_dl_popup(element) {
        swal({
            title: "Are you sure?",
            text: "You want to Verify this Account? This assumes that the Driver has been verified and can start using the account!",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Yes, Save as verified!",
            closeOnConfirm: false
        },

            function verify_driver_account() {
                window.location.href = '/verify_driver_account/{{formData.update_id}}';
            });

    }

    function view_driver_account_dl_popup(element) {
        swal({
            title: "View Full DL Image?",
            text: "This will open the Driving Licence Image in new window for confirmation", 
            showCancelButton: true, 
            confirmButtonText: "Okay",
            closeOnConfirm: false
        },

            function disable_driver_account() {
                const link = '{{ formData.driver.identificationDocumentUrl }}';
                //window.location.href = 
                window.open(link);
                window.close();
            });

    }

    function search_driver_activity() {
        window.location.href = '/driver/search_activity/{{formData.update_id}}';
    } 

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>

{% endblock content %}