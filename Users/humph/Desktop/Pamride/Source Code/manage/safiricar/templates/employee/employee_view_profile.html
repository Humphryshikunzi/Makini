{% extends './base.html' %}

{% block content %}

<style>
    .content {
        width: 90% !important;
    }

    .float-container {
        border: 3px solid #fff;
        padding: 5px;
    }

    .float-child {
        width: 50%;
        float: left;
        padding: 5px;
        border-right: 2px solid rgb(145, 255, 0);
    }

    .float-child-right {
        width: 50%;
        float: left;
        padding: 5px;
    }

    td a:visited {
        color: blueviolet !important;
    }

    td a:hover {
        color: #c1c117 !important;
    }

    input {
        position: absolute;
        right: 0;
    }


    /* Float four columns side by side */
    .column {
        float: left;
        width: 50%;
        padding: 0 10px;
    }
        /* Remove extra left and right margins, due to padding */
    .row {margin: 0 -5px;}

    /* Clear floats after the columns */
    .row:after {
    content: "";
    display: table;
    clear: both;
    }
 
    /* Responsive columns */
    @media screen and (max-width: 600px) {
        .column {
            width: 100%;
            display: block;
            margin-bottom: 20px;
        }
    }

    /* Style the counter cards */
    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        padding: 16px;
        text-align: center; 
        height: 210px;
    }
</style>

<link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet" />

<div class="float-container row highlight" style="background-color: #FFF9EFFF;">
    <div class="float-child-right">
        <div class="green">           

            <div class="row highlight" style="padding-top:1%;margin-right: 22px; border-radius: 2%;">
                <h3 class="page-heading">Employee "{{formData.employee.userName}}" Details</h3>
                <div class="column">
                    <div class="card">
                        <form enctype="multipart/form-data" action="/employee_profile/upload_profile/{{formData.employee.id}}" method="post">
                            <input type="file" name="filename" id="filename" accept="image/*" onchange="previewImage()" style="margin-right:1166px; margin-top: 170px;visibility:hidden;" />
                            <img id="profileImageFrame" src="data:image/jpg;base64,{{ formData.profile_image | safe }}" width="160px" height="160px">
                            <br>
                             {% if session['username'] ==  formData.employee.userName  %}
                            <input id="editImage" value="Edit" type="button" style="margin-right: 1176px; margin-top: 10px;" onclick="toggleImageVisibility()"/> 
                             {% endif %}
                            <input id="saveImage" type="submit" value="Save" style="margin-right: 1126px; margin-top: 10px;visibility: hidden;"/>
                            <input type="hidden" id="employee_update_id" value="{{formData.employee.id}}" />
                        </form>
                    </div>
                </div>

                <div class="column">
                    <div class="card">
                        <div class="form-group">
                            <label for="employee_id" style="text-align: center;">ID : {{formData.employee.id}}</label> 
                        </div>

                        <div class="form-group">
                            <label for="employee_name"  style="text-align: left;">UserName : {{formData.employee.userName}}</label>
                        </div>

                        <div class="form-group">
                            <label for="employee_email" style="text-align: left;">Email : {{formData.employee.email}} </label> 
                        </div>

                    </div>
                </div>
            </div>
            
            <form method="post" style="margin-right:30px;" class="form-validate" action="/employee_profile{% if formData.update_id %}/{{formData.update_id}}{% endif %}">
                <div class="row highlight" style="padding-top:1%;border-radius: 2%;">
                  
                    <div class="col-md-8" style="padding: 3%;margin-top: 10px;">                      
                        <div class="form-group">                           

                            <div class="form-group">
                                <label for="employee_nationalid">National Id : </label>
                                <input value="{{formData.employee.nationalId}}" disabled="true" />
                            </div>

                            <div class="form-group">
                                <label for="employee_last_name">Last Name : </label>
                                <input value="{{formData.employee.lastName}}" disabled="true" />
                            </div>

                            <div class="form-group">
                                <label for="employee_last_name">Phone Number : </label>
                                <input value="{{formData.employee.phoneNumber}}" disabled="true" />
                            </div>

                            <div class="form-group">
                                <label for="employee_isactive">IsActive : </label>
                                <input value="{{formData.employee.isActive}}" disabled="true" />
                            </div>
                        </div>

                        <div class="form-group" style="margin-top: 10px;">
                            <label for="employee_address">Roles : </label>
                            <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th class="th-sm">RoleId</th>
                                        <th class="th-sm">Role Name</th>
                                        <th class="th-sm">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if formData.employee %}
                                    {% for car in formData.employee.ownedCars %}
                                    <tr>
                                        <td>{{car.licensePlate}}</td>
                                        <td>{{car.model}}</td>
                                        <td><button type="button" class="btn btn-warning" style="height: 36px;" onclick="remove_employee_role_popup()">Remove Role</button></td>
                                    </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="7"> Employee Does not not belong to any role</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>

                        <input type="hidden" id="employee_delete_id" value="{{formData.update_id}}"/>
                        <button type="button" class="btn btn-primary" id="cancel" onclick="return window.history.back();">Back</button>
                        <button type="button" class="btn btn-success" onclick="add_employee_role(this);">Make Admin</button>
                        <button type="button" class="btn btn-warning" onclick="disable_employee_account_popup(this);">Disable Account</button>

                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="float-child">
        <div class="green">           
            <form method="post" style="margin-left:30px" class="form-validate"
                action="/employee_profile{% if formData.update_id %}/{{formData.update_id}}{% endif %}">
                <div class="row highlight" style="padding-top:2%;border-radius:2%;">
                    <h3 class="page-heading">Employee Activities</h3> 

                    <div class="form-group" style="margin-right: 10px;"> 
                        <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0"  width="100%">
                            <thead>
                                <tr>
                                    <th class="th-sm">ActivityId</th>
                                    <th class="th-sm">Title</th>
                                    <th class="th-sm">Description</th>
                                    <th class="th-sm">Date</th>
                                    <th class="th-sm">Time</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% if formData.userActivities_obj %}
                                {% for userActivity in formData.userActivities_obj %}
                                <tr>
                                    <td>{{userActivity.id}}</td>
                                    <td>{{userActivity.title}}</td>
                                    <td>{{userActivity.description}}</td>
                                    <td>{{userActivity.activityDate}}</td>
                                    <td>{{userActivity.timeOfActivity}}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="7">No Employee Activity Found</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <input type="hidden" id="employee_delete_id" value="{{formData.update_id}}" />
                </div>
        </div>
        </form>
    </div>
</div>
<script>
    function disable_employee_account_popup(element) {
        swal({
            title: "Are you sure?",
            text: "You want to Disable this Account? The owner will not be able to use it until its enabled!",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Yes, Disable it!",
            closeOnConfirm: false
        },
            function disable_employee_account() {
                window.location.href = '/disable_employee_account/{{formData.update_id}}';
            });
    }

    function search_employee_activity() {
        window.location.href = '/employee/search_employee_activity/{{formData.update_id}}';
    }

    function remove_employee_role_popup(element) {
        swal({
            title: "Are you sure?",
            text: "This employee will no longer have access to resources and actions as per this role!",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Yes, Remove From Role!",
            closeOnConfirm: false
        },
            function remove_employee_role() {
                window.location.href = '/employee/remove_role/{{formData.employee.id}}';
            });
    }

    function add_employee_role() {
        window.location.href = '/add_to_role/{{formData.employee.id}}';
    } 
</script>

<script>
    function previewImage() {
        profileImageFrame.src = URL.createObjectURL(event.target.files[0]);
    } 
    function toggleImageVisibility(){
        var filename = document.getElementById("filename");
        var saveImage = document.getElementById("saveImage");
        var editImage = document.getElementById("editImage"); 

        if(filename.style.visibility==="hidden"){
            filename.style.visibility = "visible";
            saveImage.style.visibility = "visible";
            editImage.style.visibility = "hidden"
        }
        else{
            filename.style.visibility = "hidden";
            saveImage.style.visibility = "hidden";
            editImage.style.visibility = "visible"
        } 
    }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>

{% endblock content %}